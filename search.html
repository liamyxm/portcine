<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>PortCine</title>
		<link href="./bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
		<style>
			.center {
				position: absolute;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
			}
		</style>
	</head>
	<body class="text-bg-dark">
		<div class="container center">
			<h2>PortCine - Search Results</h2>
			<form action="./search">
				<div class="input-group mb-3">
					<input type="text" class="form-control" placeholder="Search for movies or TV shows" aria-label="Search for movies or TV shows" aria-describedby="search-input" name="q" id="q">
					<button class="btn btn-outline-success" type="submit" id="search-input" value="submit">
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
							<path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
						</svg>
					</button>
				</div>
			</form>
			<div id="results"></div>
			<br>
			<p>Created by yuxyym</p>
			<p class="fw-light">Powered by <a href="https://vidsrc.me/">VidSrc</a></p>
		</div>
		<script>
			(async () => {
				const searchParams = new URLSearchParams(window.location.search);
				if (!searchParams.has('q')) return document.getElementById('results').innerHTML = "To perform a search, append the q parameter to the URL and specify your search term as its value. Currently, there is no value specified for the q parameter, so no movies or TV shows have been displayed.";
				const query = encodeURIComponent(searchParams.get('q'));
				const link = `https://corsproxy.io/?url=https://v2.sg.media-imdb.com/suggests/h/${query}.json`;
				// If you are looking through the source code and the corsproxy.io looks suspicious, it's not.
				// Here's why:
				// CORS is a browser security rule that blocks web pages from making requests to a different domain (or server) than the one the page was loaded from.
				// In this instance, I am trying to fetch data from media-imdb.com, but the browser is blocking the request, unless media-imdb.com explicitly allows it (which it won't).
				// So corsproxy.io acts as a middleman.
				// Here, I send a request to the proxy server corsproxy.io instead of the original link at media-imdb.com
				// The proxy forwards that request to media-imdb.com
				// The proxy fetches the data then sends it back here using headers that trick the browser into thinking the data came from the same domain.
				// This bypasses CORS.
				// But it still might not be 100% safe. I myself as the creator don't host corsproxy so I can't verify whether or not it is definitely safe.
				// Please avoid sending sensitive information by typing them into the search bar and searching it.
				// Thanks for reading all of this
				let data = {};
				try {
					const response = await fetch(link);
					if (!response.ok) return document.getElementById('results').innerHTML = `There was an error with searching. Here is the response status: ${response.status}.<br><br>If this keeps happening, try the following steps.<ol><li>Go to the IMDb website and search for your movie or TV series</li><li>Click on your movie or TV series</li><li>In the link, highlight the identifier between the /link/ and the next / in the URL. It should look something like this: tt0123456</li><li>Copy the identifier and paste it into the search here</li></ol>`;
					const rawData = await response.text();
					const jsonString = rawData.substring(rawData.indexOf('(') + 1, rawData.lastIndexOf(')'));
					data = JSON.parse(jsonString);
				} catch (error) {
					return document.getElementById('results').innerHTML = `There was an error with searching. Here is the error: ${error}.<br><br>If this keeps happening, try the following steps.<ol><li>Go to the IMDb website and search for your movie or TV series</li><li>Click on your movie or TV series</li><li>In the link, highlight the identifier between the /link/ and the next / in the URL. It should look something like this: tt0123456</li><li>Copy the identifier and paste it into the search here</li></ol>`;
				}
				console.log(data)
			})();
		</script>
	</body>
</html>
